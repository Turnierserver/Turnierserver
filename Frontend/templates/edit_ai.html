{% extends "base.html" %}
{% set active_page = "edit_ai" %}
{% block body %}
<form class="ui form" id="form">
	<h4 class="ui dividing header">Ki Infos</h4>
	<div class="two fields">
		<div class="field">
			<label>Name</label>
			<div class="two fields">
				<div class="field">
					<input type="text" name="name" id="name" placeholder="Name" value="{{ ai.name }}">
				</div>
			</div>
		</div>
	</div>
	<br />
	<div class="two fields">
		<div class="field">
			<label>Sprache</label>
			<select class="ui search dropdown" id="lang">
				<option value="{{ ai.lang.id }}">{{ ai.lang.name}}</option>
				{% for lang in langs %}
					{% if lang != ai.lang %}
					<option value="{{ lang.id }}">{{ lang.name }}</option>
					{% endif %}
				{% endfor %}
			</select>
		</div>
		<div class="field">
			<label>Extras</label>
			<select name="extras" multiple="" class="ui fluid dropdown" id="extras">
				<option value="">Extras:</option>
				<option value="pypy" class="active selected">Pypy</option>
				<option value="lombok">Lombok</option>
				<option value="dmlib">DeineMudda</option>
				<option value="swag">Swag</option>
				<option value="yolo">Y∂l∂</option>
			</select>
			<script>
				// ## Das ist verdammt haesslig und sollte nicht verdammt haesslig sein.
				$("#extras").dropdown("set selected", [
					{% for selected in ai.lastest_version().extras() %}
						"{{selected}}",
					{% endfor %}
				]);
			</script>
		</div>
	</div>
	<div class="field">
		<label>Beschreibung</label>
		<textarea id="desc">{{ ai.desc }}</textarea>
	</div>
	<div id="submit" class="ui huge teal labeled icon submit button">
		<i class="save outline icon"></i> Update
	</div>
	<a class="ui huge labeled icon submit button" href="{{url_for("profile.file_browser", id=ai.id, path="")}}">
		<i class="disk outline icon"></i> Dateibrowser
	</a>
	<div id="copy_code" class="ui huge labeled icon button">
		<i class="copy outline icon"></i> Beispiel-code kopieren
	</div>
	<div id="delete" class="ui huge red labeled icon button">
		<i class="trash outline icon"></i> KI löschen
	</div>
</form>

<div id="delete_modal" class="ui basic modal">
	<i class="close icon"></i>
	<div class="header">
		KI löschen
	</div>
	<div class="content">
		<div class="image">
			<i class="trash outline icon"></i>
		</div>
		<div class="description">
			<p>Das löschen einer KI kann nicht rückgängig gemacht werden! Willst du {{ai.name}} wirklich löschen?</p>
		</div>
	</div>
	<div class="actions">
		<div class="two fluid ui inverted buttons">
			<div class="ui red basic inverted cancel button">
				<i class="remove icon"></i>
				Nein
			</div>
			<div class="ui green basic inverted ok button">
				<i class="checkmark icon"></i>
				Ja
			</div>
		</div>
	</div>
</div>



<script>

$('.ui.checkbox').checkbox();
$('select.dropdown').dropdown();


var f = function() {
	console.log("Updating AI in...")
	$('#form').addClass('loading')
	var name = $("#name").val()
	var lang = $("#lang").val()
	var desc = $("#desc").val()
	var extras = $("#extras").val()

	var d = {
		name: name,
		lang: lang,
		description: desc,
		extra: extras
	}
	console.log(name, lang, desc, extras)

	$.post("/api/ai/{{ai.id}}/update", d).done(function(data) {
		console.log("AI changed.")
		location.reload();
	}).fail(function(xhr, textStatus, errorThrown) {
		console.log(xhr.responseText.error)
		alert(JSON.parse(xhr.responseText).error)
	})
}

$("#submit").on("click", f)

$("#copy_code").on("click", function() {
	$('#form').addClass('loading')
	$.post("/api/ai/{{ai.id}}/copy_example_code", {}).done(function(data) {
		console.log("Code copied.")
		location.reload();
	}).fail(function(xhr, textStatus, errorThrown) {
		console.log(xhr.responseText.error)
		alert(JSON.parse(xhr.responseText).error)
	})
});


$("#delete").on("click", function() {
	$('#delete_modal').modal({
		onApprove: function() {
			$.post("/api/ai/{{ai.id}}/delete").done(function(data) {
				console.log("AI deleted.")
				location.href = "/"
			}).fail(function(xhr, textStatus, errorThrown) {
				console.log(xhr.responseText.error)
				alert(JSON.parse(xhr.responseText).error)
			})
		}
	}).modal('show')
});


</script>
{% endblock %}